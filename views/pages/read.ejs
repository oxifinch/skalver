<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
        <title><%= book.title %> | Skalver</title>
		<meta name="description" content="Skalver reading page"/>
		<meta name="viewport" content="width=device-width, initial-scale=1"/>
        <link rel="stylesheet" href="/css/style.css">
        <style>
            .hidden {
                display: none;
            }
            #reader_page_markdown {
                white-space: pre-wrap;
            }
        </style>
	</head>

	<body>
        <%- include ("../partials/read-modal-editbook.ejs", {book: book}) %>
        <header>
            <a href="/library">Go Back</a>
            <p><%= book.title %> by <%= book.author %> | <%= chapterNumber+1 %>/<%= book.chapters.length %>: <%= chapter.name %></p>

            <button data-bs-toggle="modal" data-bs-target="#read_editbook_modal" id="button_edit_book" class="btn btn-success w-100">Edit Book Info</button>
        </header>
        <div id="new_chapter_window" class="hidden ">
            <h2>Create New Chapter</h2> 
            <form action="/chapter/create/<%=book.id%>" method="POST">
                <h4>Name</h4>
                <input type="text" name="name" id="editor_new_name">
                <textarea name="markdown" id="editor_new_markdown" cols="60" rows="20"></textarea>
                <button type="submit">Create</button>
            </form>
        </div>
        <button id="new_chapter_button" class="btn btn-primary">Create New Chapter</button>
        <main>
            <button id="reader_edit">Edit</button>
            <button id="reader_save">Save Changes</button>
            <div id="reader_page" style="width: 60rem; margin: auto; border: 2px solid black; padding: 1rem;">
                <div id="reader_page_content">
                    <%- htmlOutput %>
                </div>
                <div id="reader_page_markdown" class="hidden">
                    <textarea id="reader_editor_textarea" cols="80" rows="40" style="resize: none">
                    </textarea>
                </div>
            </div>
        </main>
        <a href="<%= prevChapter %>">Prev</a>
        <a href="<%= nextChapter %>">Next</a>
        <script>
            let activeChapter = <%- JSON.stringify(chapter) %>
            let parentBook = <%- JSON.stringify(book) %>
        </script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script>
        <script src="/js/app.js"></script>
	</body>
</html>

